
<!-- Hidden file input for loading projects -->
<input type="file" class="hidden" #fileInputForLoad (change)="handleLoadProjectFile($event)" accept="video/*" />

@if (view() === 'hero') {
<main class="min-h-screen text-white flex flex-col items-center justify-center p-8 text-center bg-[#131313]">
  <div class="max-w-3xl w-full">
    <div class="mb-12">
      <h1 class="text-6xl font-bold mb-4">Gnembren Captions</h1>
      <p class="text-xl text-gray-400">The AI-powered video editor for creating stunning, accessible content.</p>
    </div>

    <label for="new-project-upload" class="w-full max-w-sm mx-auto group cursor-pointer mb-12 flex flex-col items-center justify-center p-8 border-2 border-dashed border-zinc-600 hover:border-blue-500 hover:bg-zinc-800/50 rounded-2xl transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 group-hover:text-blue-500 mb-4 transition-colors"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>
      <span class="text-lg font-semibold text-gray-300">Create New Project</span>
      <span class="text-sm text-gray-500">Click or drag & drop a video file to start</span>
    </label>
    <input id="new-project-upload" type="file" class="hidden" (change)="handleNewProjectFile($event)" accept="video/*" />

    @if(projects().length > 0) {
      <div class="text-left">
        <h2 class="text-2xl font-semibold mb-4">Recent Projects</h2>
        <div class="space-y-3">
          @for (project of projects(); track project.id) {
            <button (click)="loadProject(project)" class="w-full flex items-center justify-between p-4 bg-[#18181b] border border-[#333333] hover:border-blue-500 rounded-lg text-left transition-colors">
              <div>
                <p class="font-semibold text-white">{{ project.name }}</p>
                <p class="text-sm text-gray-400">Last modified: {{ project.lastModified | date:'short' }}</p>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polyline points="9 18 15 12 9 6"></polyline></svg>
            </button>
          }
        </div>
      </div>
    }
  </div>
</main>
} @else {
<main class="h-screen text-white flex flex-col bg-[#131313]">
  <header class="flex-shrink-0 bg-[#18181b] border-b border-[#333333]">
    <div class="max-w-screen-2xl mx-auto p-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button (click)="goHome()" class="p-1 hover:bg-zinc-700 rounded-md transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
        <h1 class="text-xl font-bold">Gnembren Captions</h1>
      </div>
      <button (click)="downloadVideo()" [disabled]="clips().length === 0" class="flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        <span>Export</span>
      </button>
    </div>
  </header>

  <div class="flex-grow grid gap-6 p-4 max-w-screen-2xl mx-auto w-full transition-all duration-300" [style.grid-template-columns]="isPlayerPanelCollapsed() ? '44px 1fr' : (isEditorPanelCollapsed() ? '1fr 44px' : '1fr 450px')">
    <!-- Left side: Video Player & Timeline -->
    <div class="flex flex-col flex-grow min-w-0" [class.items-center]="isPlayerPanelCollapsed()">
      <button (click)="togglePlayerPanel()" class="self-center p-2 mb-2 text-zinc-400 hover:text-white hover:bg-zinc-700 rounded-full transition-colors" [class.rotate-180]="isPlayerPanelCollapsed()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/></svg></button>
      @if(!isPlayerPanelCollapsed()) {
        <div class="flex-grow flex flex-col min-w-0">
          <div class="w-full bg-black flex items-center justify-center rounded-xl overflow-hidden shadow-2xl transition-all duration-300" [class.aspect-video]="canvasAspectRatio() === '16:9'" [class.aspect-[9/16]]="canvasAspectRatio() === '9:16'" [class.aspect-square]="canvasAspectRatio() === '1:1'">
            <div class="w-full h-full relative bg-black">
              <video #videoPlayer controls class="w-full h-full object-contain" [src]="clips()[0]?.objectUrl" (timeupdate)="onTimeUpdate($event)"></video>
              @if (currentCaption(); as caption) { <div class="absolute bottom-[10%] left-1/2 -translate-x-1/2 w-full px-4 pointer-events-none flex" [style.justify-content]="textAlign()" [style.max-width.%]="captionMaxWidth()"> <p class="font-bold text-white transition-all duration-200 inline-block px-3 py-1 rounded-md" [class.animate-fade-in]="captionAnimation() === 'fade'" [class.animate-pop-in]="captionAnimation() === 'pop'" [class.animate-slide-in-bottom]="captionAnimation() === 'slide'" [style.backgroundColor]="textBackgroundEnabled() ? textBackgroundColor() : 'transparent'" [style.font-family]="selectedFont()" [style.font-size.px]="fontSize()" [style.color]="textColor()" [style.fontWeight]="fontWeight()" [style.fontStyle]="fontStyle()" [style.textDecoration]="textDecoration()" [style.textTransform]="textTransform()" [style.letterSpacing.px]="letterSpacing()" [style.lineHeight]="lineHeight()" [style.text-shadow]="textShadowEnabled() ? '2px 2px 8px rgba(0,0,0,0.8)' : textStrokeStyle()" [style.textAlign]="textAlign()"> @if (karaokeEnabled() && caption.words?.length) { @for (word of caption.words; track $index) { <span [style.color]="$index <= activeWordIndex() ? karaokeColor() : textColor()">{{ word.text }} </span> } } @else { {{ caption.text }} } </p> </div> }
              @if(isLoading()) { <div class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center z-10"> <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-lg font-semibold mt-4">Processing Video...</p> </div> }
            </div>
          </div>
          <div class="mt-4 p-3 bg-[#18181b] border border-[#333333] rounded-xl space-y-3">
            <div class="flex items-center justify-end gap-2"> <button class="p-2 rounded-md hover:bg-zinc-700 transition-colors" title="Split Clip (S)"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22v-8"/><path d="M8 8H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4"/><path d="M16 8h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4"/><path d="m15 5-3-3-3 3"/><path d="m9 19 3 3 3-3"/></svg></button> <label for="add-clip-upload" class="p-2 rounded-md hover:bg-zinc-700 transition-colors cursor-pointer" title="Add Clip"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg></label> <input id="add-clip-upload" type="file" class="hidden" (change)="handleNewProjectFile($event)" accept="video/*" /> <div class="flex items-center gap-2"> <label for="playback-speed" class="text-sm font-medium text-gray-300">Speed:</label> <select id="playback-speed" (change)="setPlaybackRate(+$event.target.value)" [value]="playbackRate()" class="bg-[#131313] border border-[#333333] rounded-md text-sm p-1 focus:ring-2 focus:ring-blue-500 outline-none"> <option value="0.5">0.5x</option><option value="1">1x</option><option value="1.5">1.5x</option><option value="2">2x</option> </select> </div> </div>
            <div class="bg-black/50 p-2 rounded-lg h-20 flex items-center gap-2 overflow-x-auto"> @for(clip of clips(); track clip.id) { <div class="h-full aspect-video bg-zinc-700 rounded-md flex-shrink-0 border-2 border-transparent hover:border-blue-500"> </div> } </div>
          </div>
        </div>
      }
    </div>

    <!-- Right side: Editor Panel -->
    <div class="bg-[#18181b] border border-[#333333] rounded-xl flex flex-col min-w-0" [class.items-center]="isEditorPanelCollapsed()">
       <button (click)="toggleEditorPanel()" class="self-center p-2 mt-2 text-zinc-400 hover:text-white hover:bg-zinc-700 rounded-full transition-colors" [class.rotate-180]="!isEditorPanelCollapsed()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M15 3v18"/></svg></button>
       @if(!isEditorPanelCollapsed()) {
        <div class="flex flex-col flex-grow min-w-0">
          @if(videoInfo(); as info) { <div class="flex-shrink-0 p-4 border-b border-[#333333] space-y-2"><p class="text-sm font-semibold text-gray-300 truncate" title="{{info.name}}">{{ info.name }}</p><div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-400"><span>Resolution: <strong class="font-medium text-gray-300">{{ info.resolution }}</strong></span><span>Aspect Ratio: <strong class="font-medium text-gray-300">{{ info.aspectRatio }}</strong></span><span>Duration: <strong class="font-medium text-gray-300">{{ info.duration }}</strong></span><span>Size: <strong class="font-medium text-gray-300">{{ info.size }}</strong></span></div></div> }
          <div class="flex-shrink-0 flex items-center border-b border-[#333333] text-sm"><button (click)="activeTab.set('captions')" [class]="activeTab() === 'captions' ? 'bg-[#27272a] text-white' : 'text-gray-400 hover:bg-[#27272a]/50'" class="px-3 py-3 font-semibold transition-colors w-1/5 text-center">Captions</button><button (click)="activeTab.set('style')" [class]="activeTab() === 'style' ? 'bg-[#27272a] text-white' : 'text-gray-400 hover:bg-[#27272a]/50'" class="px-3 py-3 font-semibold transition-colors w-1/5 text-center">Style</button><button (click)="activeTab.set('layout')" [class]="activeTab() === 'layout' ? 'bg-[#27272a] text-white' : 'text-gray-400 hover:bg-[#27272a]/50'" class="px-3 py-3 font-semibold transition-colors w-1/5 text-center">Layout</button><button (click)="activeTab.set('format')" [class]="activeTab() === 'format' ? 'bg-[#27272a] text-white' : 'text-gray-400 hover:bg-[#27272a]/50'" class="px-3 py-3 font-semibold transition-colors w-1/5 text-center">Format</button><button (click)="activeTab.set('animate')" [class]="activeTab() === 'animate' ? 'bg-[#27272a] text-white' : 'text-gray-400 hover:bg-[#27272a]/50'" class="px-3 py-3 font-semibold transition-colors w-1/5 text-center">Animate</button></div>
          <div data-editor-panel class="flex-grow p-4 overflow-y-auto">
              @if (activeTab() === 'captions') { <div class="flex flex-col h-full"><div class="flex-grow space-y-2 overflow-y-auto pr-2">@for (caption of captions(); track caption.id; let i = $index) { <div (click)="selectCaption(i)" [class]="selectedCaptionIndex() === i ? 'bg-blue-600/20 border-blue-500' : 'border-transparent hover:bg-zinc-700/50'" class="p-2.5 rounded-lg border-2 cursor-pointer transition-colors"><div class="flex gap-2 items-start"><textarea rows="2" [value]="caption.text" (input)="updateCaption(i, $event.target.value)" class="w-full bg-transparent text-white placeholder-gray-400 focus:outline-none resize-none flex-grow"></textarea><div class="flex flex-col gap-2"><button (click)="$event.stopPropagation(); splitCaption()" class="p-1 text-gray-400 hover:text-blue-400 transition-colors" title="Split Caption"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22v-8"/><path d="M8 8H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4"/><path d="M16 8h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4"/><path d="m15 5-3-3-3 3"/><path d="m9 19 3 3 3-3"/></svg></button><button (click)="$event.stopPropagation(); deleteCaption(i);" class="p-1 text-gray-400 hover:text-red-400 transition-colors" title="Delete Caption"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button></div></div><div class="flex items-center gap-2 mt-1"><input type="number" step="0.1" [value]="caption.startTime" (input)="caption.startTime = +$event.target.value" class="w-1/2 bg-[#131313] p-1 rounded text-center focus:outline-none focus:ring-2 focus:ring-blue-500"><span class="text-gray-500">â†’</span><input type="number" step="0.1" [value]="caption.endTime" (input)="caption.endTime = +$event.target.value" class="w-1/2 bg-[#131313] p-1 rounded text-center focus:outline-none focus:ring-2 focus:ring-blue-500"></div></div>}</div><div class="flex-shrink-0 pt-4"><button (click)="addCaption()" class="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-[#27272a] text-white rounded-md font-semibold hover:bg-[#3f3f46] transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>Add Caption</button></div></div> }
              @if (activeTab() === 'style') { <div class="space-y-5"><div class="p-2 border border-[#333333] rounded-lg space-y-3 bg-[#131313]/50"><div class="flex justify-between items-center"><h4 class="text-sm font-semibold">Presets</h4><button (click)="resetStyles()" class="text-xs text-gray-400 hover:text-white transition-colors">Reset</button></div><div class="grid grid-cols-3 gap-2"> @for(preset of stylePresets(); track preset.name) { <button (click)="applyPreset(preset)" class="text-xs p-2 rounded-md bg-[#27272a] hover:bg-blue-600 transition-colors">{{preset.name}}</button> } </div></div><div><label class="block text-sm font-medium text-gray-300 mb-2">Font</label><select class="w-full p-2.5 bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none" [(ngModel)]="selectedFont">@for(font of fonts();track font.name){<option [value]="font.family" [style.font-family]="font.family">{{font.name}}</option>}</select></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-300 mb-2">Font Size</label><input type="number" [(ngModel)]="fontSize" class="w-full p-2 bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none"></div><div><label class="block text-sm font-medium text-gray-300 mb-2">Color</label><input type="color" [value]="textColor()" (input)="textColor.set($event.target.value)" class="w-full h-10 p-1 bg-[#131313] border border-[#333333] rounded-md cursor-pointer"></div></div><div class="grid grid-cols-2 gap-4"><div class="grid grid-cols-3 gap-1 bg-[#131313] p-1 rounded-md border border-[#333333]"><button (click)="fontWeight.set(fontWeight() === 700 ? 400 : 700)" [class]="fontWeight() === 700 ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors font-bold">B</button><button (click)="fontStyle.set(fontStyle() === 'italic' ? 'normal' : 'italic')" [class]="fontStyle() === 'italic' ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors italic">I</button><button (click)="textDecoration.set(textDecoration() === 'underline' ? 'none' : 'underline')" [class]="textDecoration() === 'underline' ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors underline">U</button></div><select class="bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none p-2" [(ngModel)]="textTransform"><option value="none">Normal</option><option value="uppercase">UPPERCASE</option><option value="lowercase">lowercase</option><option value="capitalize">Capitalize</option></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-300 mb-2">Letter Spacing</label><input type="number" step="0.1" [(ngModel)]="letterSpacing" class="w-full p-2 bg-[#131313] border border-[#333333] rounded-md"></div><div><label class="block text-sm font-medium text-gray-300 mb-2">Line Height</label><input type="number" step="0.1" [(ngModel)]="lineHeight" class="w-full p-2 bg-[#131313] border border-[#333333] rounded-md"></div></div></div> }
              @if (activeTab() === 'layout') { <div class="space-y-5"><div><label class="block text-sm font-medium text-gray-300 mb-2">Alignment</label><div class="grid grid-cols-3 gap-2 bg-[#131313] p-1 rounded-md border border-[#333333]"><button (click)="textAlign.set('left')" [class]="textAlign() === 'left' ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" y1="10" x2="3" y2="10"></line><line x1="21" y1="6" x2="3" y2="6"></line><line x1="21" y1="14" x2="3" y2="14"></line><line x1="21" y1="18" x2="3" y2="18"></line></svg></button><button (click)="textAlign.set('center')" [class]="textAlign() === 'center' ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="17" y1="10" x2="3" y2="10"></line><line x1="21" y1="6" x2="3" y2="6"></line><line x1="21" y1="14" x2="3" y2="14"></line><line x1="17" y1="18" x2="3" y2="18"></line></svg></button><button (click)="textAlign.set('right')" [class]="textAlign() === 'right' ? 'bg-blue-600' : 'hover:bg-zinc-700'" class="p-2 rounded flex justify-center items-center transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" y1="10" x2="7" y2="10"></line><line x1="21" y1="6" x2="3" y2="6"></line><line x1="21" y1="14" x2="3" y2="14"></line><line x1="21" y1="18" x2="7" y2="18"></line></svg></button></div></div><div><label class="block text-sm font-medium text-gray-300 mb-2">Max Width ({{captionMaxWidth()}}%)</label><input type="range" min="20" max="100" [value]="captionMaxWidth()" (input)="captionMaxWidth.set(+$event.target.value)" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></div><div class="flex items-center justify-between"><label class="text-sm font-medium text-gray-300">Shadow</label><button (click)="toggleTextShadow()" [class]="textShadowEnabled() ? 'bg-blue-600' : 'bg-gray-600'" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"><span [class]="textShadowEnabled() ? 'translate-x-6' : 'translate-x-1'" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span></button></div><div class="flex items-center justify-between"><label class="text-sm font-medium text-gray-300">Background</label><button (click)="toggleTextBackground()" [class]="textBackgroundEnabled() ? 'bg-blue-600' : 'bg-gray-600'" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"><span [class]="textBackgroundEnabled() ? 'translate-x-6' : 'translate-x-1'" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span></button></div>@if(textBackgroundEnabled()){<div><label class="block text-sm font-medium text-gray-300 mb-2">Bg Color</label><input type="color" [value]="textBackgroundColor()" (input)="textBackgroundColor.set($event.target.value)" class="w-full h-10 p-1 bg-[#131313] border border-[#333333] rounded-md cursor-pointer"></div>}<div class="flex items-center justify-between"><label class="text-sm font-medium text-gray-300">Stroke</label><button (click)="toggleTextStroke()" [class]="textStrokeEnabled() ? 'bg-blue-600' : 'bg-gray-600'" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"><span [class]="textStrokeEnabled() ? 'translate-x-6' : 'translate-x-1'" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span></button></div>@if(textStrokeEnabled()){<div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-300 mb-2">Stroke Width</label><input type="number" [(ngModel)]="textStrokeWidth" class="w-full p-2 bg-[#131313] border border-[#333333] rounded-md"></div><div><label class="block text-sm font-medium text-gray-300 mb-2">Stroke Color</label><input type="color" [value]="textStrokeColor()" (input)="textStrokeColor.set($event.target.value)" class="w-full h-10 p-1 bg-[#131313] border border-[#333333] rounded-md cursor-pointer"></div></div>}</div> }
              @if (activeTab() === 'format') { <div class="space-y-5"><div><label class="block text-sm font-medium text-gray-300 mb-2">Canvas Aspect Ratio</label><div class="grid grid-cols-3 gap-2"><button (click)="canvasAspectRatio.set('16:9')" class="p-2 rounded-lg border-2 transition-colors flex flex-col items-center justify-center gap-2" [class]="canvasAspectRatio() === '16:9' ? 'border-blue-500 bg-blue-500/10' : 'border-zinc-600 hover:border-zinc-400'"><div class="w-16 h-9 bg-zinc-500 rounded"></div><span class="text-xs">YouTube 16:9</span></button><button (click)="canvasAspectRatio.set('9:16')" class="p-2 rounded-lg border-2 transition-colors flex flex-col items-center justify-center gap-2" [class]="canvasAspectRatio() === '9:16' ? 'border-blue-500 bg-blue-500/10' : 'border-zinc-600 hover:border-zinc-400'"><div class="w-9 h-16 bg-zinc-500 rounded"></div><span class="text-xs">Reel 9:16</span></button><button (click)="canvasAspectRatio.set('1:1')" class="p-2 rounded-lg border-2 transition-colors flex flex-col items-center justify-center gap-2" [class]="canvasAspectRatio() === '1:1' ? 'border-blue-500 bg-blue-500/10' : 'border-zinc-600 hover:border-zinc-400'"><div class="w-12 h-12 bg-zinc-500 rounded"></div><span class="text-xs">Square 1:1</span></button></div></div></div> }
              @if (activeTab() === 'animate') { <div class="space-y-5"><div><label class="block text-sm font-medium text-gray-300 mb-2">Entrance Animation</label><select class="w-full p-2.5 bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none" [(ngModel)]="captionAnimation"><option value="none">None</option><option value="fade">Fade In</option><option value="pop">Pop Up</option><option value="slide">Slide In</option></select></div><div class="flex items-center justify-between"><label class="text-sm font-medium text-gray-300">Karaoke Effect</label><button (click)="toggleKaraoke()" [class]="karaokeEnabled() ? 'bg-blue-600' : 'bg-gray-600'" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"><span [class]="karaokeEnabled() ? 'translate-x-6' : 'translate-x-1'" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span></button></div> @if(karaokeEnabled()){<div><label class="block text-sm font-medium text-gray-300 mb-2">Active Word Color</label><input type="color" [value]="karaokeColor()" (input)="karaokeColor.set($event.target.value)" class="w-full h-10 p-1 bg-[#131313] border border-[#333333] rounded-md cursor-pointer"></div>}</div> }
          </div>
        </div>
       }
    </div>
  </div>

  <!-- Export Modal -->
  @if(isExportModalVisible()) {
    <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-50" (click)="isExportModalVisible.set(false)">
      <div class="bg-[#18181b] border border-[#333333] rounded-xl shadow-2xl w-full max-w-md p-6" (click)="$event.stopPropagation()">
        <h2 class="text-2xl font-bold mb-6">Export Video</h2>
        <div class="space-y-4">
          <div><label class="block text-sm font-medium text-gray-300 mb-2">Resolution</label><select class="w-full p-2.5 bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none"><option>4K (2160p)</option><option selected>Full HD (1080p)</option><option>HD (720p)</option></select></div>
          <div><label class="block text-sm font-medium text-gray-300 mb-2">Format</label><select class="w-full p-2.5 bg-[#131313] border border-[#333333] rounded-md focus:ring-2 focus:ring-blue-500 outline-none"><option>MP4</option><option>MOV</option></select></div>
        </div>
        <div class="flex items-center justify-end gap-4 mt-8">
          <button (click)="isExportModalVisible.set(false)" class="px-4 py-2 bg-zinc-700 text-white rounded-md font-semibold hover:bg-zinc-600 transition-colors">Cancel</button>
          <button (click)="isExportModalVisible.set(false); downloadVideo()" class="px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700 transition-colors">Export</button>
        </div>
      </div>
    </div>
  }
</main>
}
<style>
  .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
  .animate-pop-in { animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
  .animate-slide-in-bottom { animation: slideInBottom 0.4s ease-out forwards; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
  @keyframes slideInBottom { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
</style>
